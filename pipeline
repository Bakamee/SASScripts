pipeline{

    agent {label "sasmachine"}
    stages{
        stage('prepare'){
            steps{
         
               echo "Tag ref: ${ref}"  
               echo "Git user: ${git_user} "
               echo "Git event type:  ${x_github_event}" 
               echo "Delete operation: ${deleted}"
    
            }
        }
        stage('New Code'){
             when {
               environment ignoreCase: true, name: 'ref', value: 'refs/heads/trunk'
            }
            steps{
             echo "new code commited"
             sh "echo
             Other steps which usually happen when code in developed can be executed.
             E.g. automatically run jobs on SAS Dev Server and notify business,
             once signed, off, release mananager can productionise(Tag)."
            }
        }
        stage('Checkout to Production'){
            when{
                expression{
                "${ref}" =~ /(.*)tags(.*)/ && "${deleted}"=="false"
                }
            }
            steps{
                echo "checkout to prod" 
                /*
                Other steps followed after code is productionised(tagged)
                E.g. Execute code in SAS Production environment and notify users of results.
                */
            }

        }

        
    } 
}   
