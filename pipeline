pipeline{

    agent {label "sasmachine"}
    stages{
        stage('prepare'){
            steps{
         
               echo "Tag ref: ${ref}"  
               echo "Git user: ${git_user} "
               echo "Git event type:  ${x_github_event}" 
               echo "Delete operation: ${deleted}"
    
            }
        }
        stage('New Code'){
             when {
               environment ignoreCase: true, name: 'ref', value: 'refs/heads/trunk'
            }
            steps{
             echo "new code commited"
             sh "printf Other steps which usually happen when code in developed can be executed.\nE.g. automatically run jobs on SAS Dev Server and notify business,\nonce signed, off, release mananager can productionise(Tag)."
            }
        }
        stage('Checkout to Production'){
            when{
                expression{
                "${ref}" =~ /(.*)tags(.*)/ && "${deleted}"=="false"
                }
            }
            steps{
                echo "checkout to prod" 
                sh "printf Other steps followed after code is productionised(tagged)\n.E.g. Execute code in SAS Production environment and notify users of results."
            }

        }

        
    } 
}   
