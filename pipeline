pipeline{

    agent {label "sasmachine"}
    stages{
        stage('prepare'){
            steps{
               echo " tag: ${ref}    tag operation: ${deleted}"
            }
        }
        stage('New Code'){
             when {
               environment ignoreCase: true, name: 'ref', value: 'refs/heads/trunk'
            }
            steps{
             echo "new code commited"
             //Other steps followed when new code is released. 
             //E.g. email release manager to test and productionise code by tagging it. 
            }
        }
        stage('Checkout to Production'){
            when{
                expression{
                "${ref}" =~ /(.*)tag(.*)/ && "${deleted}"=="false"
                }
            }
            steps{
                echo "checkout to prod" 
                //Other steps followed after code is productionised(tagged)
                //E.g. Execute code in SAS environment and notify users of results.
            }

        }

        
    } 
}   
